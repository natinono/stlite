<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Stlite App</title>
    <script src="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.50.0/build/stlite.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script>
      stlite.mount(
        {
          requirements: [
            "streamlit",
            "pandas",
            "plotly",
            "openpyxl",
            "numpy",
            "pyodide-http",
            "requests",
            "xlrd",
            "pyyaml"  // ä¿®æ­£: ã“ã‚Œã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºãªããªã‚Šã¾ã™
          ],
          entrypoint: "streamlit_app.py",
          files: {
            "streamlit_app.py": `
import streamlit as st
import numpy
import openpyxl
import pandas
import plotly
import sys

st.set_page_config(page_title="æŠ•è³‡ç®¡ç†App", layout="wide")

st.write("### æŠ•è³‡ç®¡ç†ã‚¢ãƒ—ãƒª (Stliteç‰ˆ)")
st.info("ğŸ‘ˆ å·¦å´ã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«ã‚ã‚‹ **'æŠ•è³‡å±¥æ­´'** ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¦ã€Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚")

st.markdown("""
#### ä½¿ã„æ–¹
1. å·¦ã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‹ã
2. **1_æŠ•è³‡å±¥æ­´** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ä¸Šéƒ¨ã«è¡¨ç¤ºã•ã‚Œã‚‹ **'Browse files'** ãƒœã‚¿ãƒ³ã‹ã‚‰ **toshin_buy.xlsx** ã‚’é¸æŠ
""")

st.write('---')
st.caption(f'System Info: Python {sys.version} / Streamlit {st.__version__}')
`,
            "pages/1_æŠ•è³‡å±¥æ­´.py": `
import pandas as pd
import datetime
from datetime import timedelta
import streamlit as st
import plotly.express as px
from pandas.core.dtypes.inference import is_number
import base64
import yaml
import io
import requests
import plotly.graph_objs as go

# --- Stliteç”¨ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‘ãƒƒãƒ ---
import pyodide_http
pyodide_http.patch_all()
# ---------------------------------

JST = datetime.timezone(timedelta(hours=+9), 'JST')

def get_growth(year, df_buy_hyouka):
    if datetime.date.today().year == year:
        end_date = datetime.date.today()
    else:
        end_date = datetime.date(year=year,month=12,day=31)
    
    end_date_str = end_date.strftime('%Y-%m-%d')
    prev_end_date_str = datetime.date(year=(year-1),month=12,day=31).strftime('%Y-%m-%d')

    # ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
    if end_date_str not in df_buy_hyouka.index:
        if not df_buy_hyouka.empty:
            # ãƒ‡ãƒ¼ã‚¿æœŸé–“å¤–ãªã‚‰æœ€æ–°ã®æ—¥ä»˜ã‚’ä½¿ã†ãªã©ã®èª¿æ•´
            if pd.to_datetime(end_date_str) > df_buy_hyouka.index[-1]:
                 end_date_str = df_buy_hyouka.index[-1].strftime('%Y-%m-%d')
            else:
                 return 0,0,0,0,0
        else:
            return 0,0,0,0,0
    
    if prev_end_date_str not in df_buy_hyouka.index:
         # å‰å¹´ã®ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆ
         return 0,0,0,0,0

    this_year_end_value = df_buy_hyouka['è©•ä¾¡é¡'].loc[end_date_str]
    previous_year_end_value = df_buy_hyouka['è©•ä¾¡é¡'].loc[prev_end_date_str]
    buy_this_year = df_buy_hyouka['è³¼å…¥é¡'].loc[end_date_str] - df_buy_hyouka['è³¼å…¥é¡'].loc[prev_end_date_str]
    
    profit = this_year_end_value - buy_this_year - previous_year_end_value
    if previous_year_end_value != 0:
        growth = profit / previous_year_end_value * 100
    else:
        growth = 0

    this_year_end_value = int(this_year_end_value/10000)
    previous_year_end_value = int(previous_year_end_value/10000)
    buy_this_year = int(buy_this_year/10000)
    profit = int(profit/10000)
    growth = round(growth, 2)
    return this_year_end_value , previous_year_end_value , buy_this_year , profit , growth

@st.cache_data(ttl=600)
def get_kagaku(fund_dict):
    # emaxisã‹ã‚‰æœ€æ–°ã®åŸºæº–ä¾¡é¡ã‚’å–å¾—
    kagaku_df = pd.DataFrame()
    
    for key, value in fund_dict.items():
        try:
            # æŠ•ä¿¡å”ä¼šã‹ã‚‰DL
            df = pd.read_csv(value, encoding='cp932', skiprows=0)
            df = df.rename(columns={'å¹´æœˆæ—¥': 'æ—¥ä»˜'})
            df['æ—¥ä»˜'] = pd.to_datetime(df['æ—¥ä»˜'], format='%Yå¹´%mæœˆ%dæ—¥')
            df = df.set_index('æ—¥ä»˜')
            df = df.iloc[:,0:1]

            df.columns = [key]
            kagaku_df = pd.concat([kagaku_df,df],axis=1)
        except Exception as e:
            pass

    if not kagaku_df.empty:
        kagaku_df = kagaku_df[kagaku_df.index >= '2019-01-01']

    # éå»ãƒ‡ãƒ¼ã‚¿(xlsx)ã®èª­ã¿è¾¼ã¿
    # kagaku.xlsx ãŒãªã„å ´åˆã¯ã€ç›´è¿‘ãƒ‡ãƒ¼ã‚¿ã®ã¿ã§å‹•ãã‚ˆã†ã«ã™ã‚‹
    try:
        kagaku_df_past = pd.read_excel('kagaku.xlsx')
        kagaku_df_past = kagaku_df_past.set_index('æ—¥ä»˜',drop=True)
        kagaku_df_past = kagaku_df_past[kagaku_df_past.index < '2019-01-01']
        df_kagaku = pd.concat([kagaku_df_past,kagaku_df])
    except Exception:
        # ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„ã€ã¾ãŸã¯èª­ã¿è¾¼ã‚ãªã„å ´åˆã¯Webå–å¾—åˆ†ã®ã¿ä½¿ç”¨
        df_kagaku = kagaku_df

    return df_kagaku

# ==========================================
# ãƒ¡ã‚¤ãƒ³å‡¦ç†
# ==========================================

# 1. ã‚µã‚¤ãƒ‰ãƒãƒ¼è¨­å®š (æœ€å„ªå…ˆã§é…ç½®)
st.sidebar.header("ğŸ“ ãƒ‡ãƒ¼ã‚¿å…¥åŠ›")
uploaded_file = st.sidebar.file_uploader("toshin_buy.xlsx ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰", type=['xlsx'])

st.sidebar.markdown("---")
st.sidebar.header("âš™ï¸ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š")

predict_period = st.sidebar.slider("äºˆæ¸¬æœŸé–“(å¹´)", 0, 30, 0, 1)

# åˆæœŸå€¤è¨­å®š
kokunai_kongo      = 0
senshinkoku_kongo  = 0
balance_kongo      = 0
zensekai_kongo     = 150000
beikoku_kongo      = 0

dict_growth = {
    "å›½å†…æ ªå¼"     : 5,
    "å…ˆé€²å›½æ ªå¼"   : 5,
    "å…¨ä¸–ç•Œæ ªå¼"   : 5,
    "ç±³å›½æ ªå¼"   : 5,
    "ãƒãƒ©ãƒ³ã‚¹"   : 3,
}

st.sidebar.subheader("æŠ•è³‡é¡è¨­å®š")
senshinkoku_kongo=st.sidebar.slider("æŠ•è³‡é¡_å…ˆé€²å›½æ ªå¼", 0, 40, int(senshinkoku_kongo/10000), 1)*10000
zensekai_kongo=st.sidebar.slider("æŠ•è³‡é¡_å…¨ä¸–ç•Œæ ªå¼", 0, 40, int(zensekai_kongo/10000), 1)*10000
beikoku_kongo=st.sidebar.slider("æŠ•è³‡é¡_ç±³å›½æ ªå¼", 0, 40, int(beikoku_kongo/10000), 1)*10000
kokunai_kongo=st.sidebar.slider("æŠ•è³‡é¡_å›½å†…æ ªå¼", 0, 40, int(kokunai_kongo/10000), 1)*10000
balance_kongo=st.sidebar.slider("æŠ•è³‡é¡_ãƒãƒ©ãƒ³ã‚¹", 0, 40, int(balance_kongo/10000), 1)*10000

st.sidebar.subheader("å¹´åˆ©è¨­å®š")
dict_growth['å…ˆé€²å›½æ ªå¼']=st.sidebar.slider("å¹´åˆ©_å…ˆé€²å›½æ ªå¼", 0, 20, dict_growth['å…ˆé€²å›½æ ªå¼'], 1)
dict_growth['å…¨ä¸–ç•Œæ ªå¼']=st.sidebar.slider("å¹´åˆ©_å…¨ä¸–ç•Œæ ªå¼", 0, 20, dict_growth['å…¨ä¸–ç•Œæ ªå¼'], 1)
dict_growth['ç±³å›½æ ªå¼']=st.sidebar.slider("å¹´åˆ©_ç±³å›½æ ªå¼", 0, 20, dict_growth['ç±³å›½æ ªå¼'], 1)
dict_growth['å›½å†…æ ªå¼']=st.sidebar.slider("å¹´åˆ©_å›½å†…æ ªå¼", 0, 20, dict_growth['å›½å†…æ ªå¼'], 1)
dict_growth['ãƒãƒ©ãƒ³ã‚¹']=st.sidebar.slider("å¹´åˆ©_ãƒãƒ©ãƒ³ã‚¹", 0, 20, dict_growth['ãƒãƒ©ãƒ³ã‚¹'], 1)


# 2. ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å‡¦ç†
buy_xlsx = None
if uploaded_file is not None:
    try:
        buy_xlsx = pd.read_excel(uploaded_file)
        st.sidebar.success("âœ… ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿æˆåŠŸ")
    except Exception as e:
        st.error(f"ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: {e}")
        st.stop()
else:
    st.info("ğŸ‘ˆ å·¦ã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‹ã‚‰ 'toshin_buy.xlsx' ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚")
    st.stop() # ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„å ´åˆã¯ã“ã“ã§å‡¦ç†ã‚’æ­¢ã‚ã‚‹

# 3. ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¨è¨ˆç®—
str_date = "2017-01-01"
future_date = str(datetime.date.today() + datetime.timedelta(days=365*predict_period))
today = datetime.datetime.today()

fund_dict = {
'å›½å†…æ ªå¼':   'https://toushin-lib.fwg.ne.jp/FdsWeb/FDST030000/csv-file-download?isinCd=JP90C000FXV1&associFundCd=03311182',
'å…ˆé€²å›½æ ªå¼': 'https://toushin-lib.fwg.ne.jp/FdsWeb/FDST030000/csv-file-download?isinCd=JP90C000ENC5&associFundCd=03319172',
'å…¨ä¸–ç•Œæ ªå¼': 'https://toushin-lib.fwg.ne.jp/FdsWeb/FDST030000/csv-file-download?isinCd=JP90C000H1T1&associFundCd=0331418A',
'ç±³å›½æ ªå¼':   'https://toushin-lib.fwg.ne.jp/FdsWeb/FDST030000/csv-file-download?isinCd=JP90C000GKC6&associFundCd=03311187',
'ãƒãƒ©ãƒ³ã‚¹':   'https://toushin-lib.fwg.ne.jp/FdsWeb/FDST030000/csv-file-download?isinCd=JP90C000EWV6&associFundCd=03312175',
}

with st.spinner('æœ€æ–°ã®åŸºæº–ä¾¡é¡ã‚’å–å¾—ä¸­...'):
    df_kagaku = get_kagaku(fund_dict)

if df_kagaku.empty:
    st.error("åŸºæº–ä¾¡é¡ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã¾ãŸã¯CORSåˆ¶é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚")
    st.stop()

leatest_date = df_kagaku.index.max()

date_index = pd.date_range("2017-01-04",end=str(datetime.datetime.today()) ,freq="D")
df_new = pd.DataFrame(index=date_index)
df_new=df_new.rename_axis('æ—¥ä»˜')
df_kagaku = pd.merge_asof(df_new, df_kagaku, on='æ—¥ä»˜',direction='backward')
df_kagaku = df_kagaku.set_index('æ—¥ä»˜', drop=True)

df_mirai = pd.DataFrame(index = pd.date_range(df_kagaku.index[len(df_kagaku)-1], future_date , freq='MS'),columns= df_kagaku.columns)
df_kagaku = pd.concat([df_kagaku,df_mirai]).groupby(level=0).last()

# å°†æ¥äºˆæ¸¬ã®è¨ˆç®—
for i in range(0,len(df_kagaku)):
    val = float(df_kagaku.iloc[i]['å›½å†…æ ªå¼']) if pd.notna(df_kagaku.iloc[i]['å›½å†…æ ªå¼']) else -1.0
    if val >= 0.0:
        pass
    else:
        for k, v in dict_growth.items():
            prev_val = df_kagaku.iloc[i-1][k]
            if pd.isna(prev_val): prev_val = 0
            days = (df_kagaku.index[i]-df_kagaku.index[i-1]).days
            df_kagaku.iloc[i,df_kagaku.columns.get_loc(k)] = prev_val * (1+v/100) ** (1/365*days)

df_kagaku_hiritu = df_kagaku.copy()
base_date = "2017-12-29"
if base_date in df_kagaku_hiritu.index:
     df_kagaku_hiritu = df_kagaku_hiritu / df_kagaku_hiritu.loc[base_date] * 100
else:
     if not df_kagaku_hiritu.empty:
        df_kagaku_hiritu = df_kagaku_hiritu / df_kagaku_hiritu.iloc[0] * 100

# 4. è³¼å…¥å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®çµåˆå‡¦ç†
df_buy = pd.DataFrame()
if buy_xlsx is not None and not buy_xlsx.empty:
    for index, data in buy_xlsx.iterrows():
        # ãƒ‡ãƒ¼ã‚¿å‹å¤‰æ›ã‚„æ¬ æå€¤å‡¦ç†
        if 'å¹´æœˆæ—¥' in data and 'ã‚¢ã‚»ãƒƒãƒˆ' in data and 'ä¾¡æ ¼' in data:
            target_date = data['å¹´æœˆæ—¥']
            target_asset = data['ã‚¢ã‚»ãƒƒãƒˆ']
            price = data['ä¾¡æ ¼']
            
            if pd.isna(target_date) or pd.isna(target_asset):
                continue

            if target_date not in df_buy.index or target_asset not in df_buy.columns:
                df_buy.loc[target_date, target_asset] = price
            else:
                df_buy.loc[target_date, target_asset] += price

    df_buy=df_buy.rename_axis('å¹´æœˆæ—¥')
    df_buy = df_buy.sort_index()
    
    df_buy.index = pd.to_datetime(df_buy.index)

    # å°†æ¥åˆ†ã®ç©ç«‹è¨­å®š
    future_mask = df_buy.index >= today
    if future_mask.any():
        first_row_index = df_buy.index[future_mask][0]
        loc_idx = df_buy.index.get_loc(first_row_index)
        if isinstance(loc_idx, slice):
            loc_idx = loc_idx.start
        
        cols = ['å›½å†…æ ªå¼', 'å…ˆé€²å›½æ ªå¼', 'ãƒãƒ©ãƒ³ã‚¹', 'å…¨ä¸–ç•Œæ ªå¼', 'ç±³å›½æ ªå¼']
        for col in cols:
            if col not in df_buy.columns:
                df_buy[col] = 0

        if not df_buy.empty:
            if 'å›½å†…æ ªå¼' in df_buy.columns: df_buy.iloc[loc_idx:, df_buy.columns.get_loc('å›½å†…æ ªå¼')] = kokunai_kongo
            if 'å…ˆé€²å›½æ ªå¼' in df_buy.columns: df_buy.iloc[loc_idx:, df_buy.columns.get_loc('å…ˆé€²å›½æ ªå¼')] = senshinkoku_kongo
            if 'ãƒãƒ©ãƒ³ã‚¹' in df_buy.columns: df_buy.iloc[loc_idx:, df_buy.columns.get_loc('ãƒãƒ©ãƒ³ã‚¹')] = balance_kongo
            if 'å…¨ä¸–ç•Œæ ªå¼' in df_buy.columns: df_buy.iloc[loc_idx:, df_buy.columns.get_loc('å…¨ä¸–ç•Œæ ªå¼')] = zensekai_kongo
            if 'ç±³å›½æ ªå¼' in df_buy.columns: df_buy.iloc[loc_idx:, df_buy.columns.get_loc('ç±³å›½æ ªå¼')] = beikoku_kongo

    df_buy = df_buy[(df_buy.index < today) | (df_buy.index.day == 1)]

    # è©•ä¾¡é¡è¨ˆç®—
    df_kagaku_hiritu = df_kagaku_hiritu.replace(0,1.0e-10)
    df_kuchisu = (df_buy / df_kagaku_hiritu).fillna(0)
    df_hyouka = df_kagaku_hiritu * df_kuchisu.cumsum() 

    date_index = df_hyouka.index
    df_new = pd.DataFrame(index=date_index)
    df_new=df_new.rename_axis('æ—¥ä»˜')
    df_buy2 = pd.concat([df_new, df_buy],axis=1,join='outer')

    df_buy_hyouka = pd.concat([df_buy2.fillna(0).cumsum().sum(axis=1),df_hyouka.sum(axis=1)],axis=1)
    df_buy_hyouka.columns = ['è³¼å…¥é¡','è©•ä¾¡é¡']
    df_buy_hyouka['ç¨å¼•ãå‰åˆ©ç›Š'] = df_buy_hyouka['è©•ä¾¡é¡'] - df_buy_hyouka['è³¼å…¥é¡']
    df_buy_hyouka['ç¨å¼•ãå¾Œåˆ©ç›Š'] = df_buy_hyouka['ç¨å¼•ãå‰åˆ©ç›Š'] * 0.8

    # è¡¨ç¤ºç”¨é–¢æ•°
    def date_judge(date):
        today_now = datetime.datetime.now()
        delta_days = (today_now - date).days
        if delta_days == 0:
            return 'ä»Šæ—¥'
        else:
            return (str(delta_days)+'æ—¥å‰')

    st.write("### æŠ•è³‡çŠ¶æ³ã‚µãƒãƒª")
    
    if leatest_date in df_buy_hyouka.index:
        try:
            display_table = pd.DataFrame({
            'æœ€æ–°åŸºæº–ä¾¡é¡':[leatest_date.strftime('%Y/%m/%d') +  ' (' + date_judge(leatest_date) + ')'],
            'è©•ä¾¡é¡':["{:.2f}".format(int(df_buy_hyouka['è©•ä¾¡é¡'][leatest_date]/10000)/100) + 'M'],
            'ç·åˆ©ç›Š':["{:+.2f}".format(int(df_buy_hyouka['ç¨å¼•ãå‰åˆ©ç›Š'][leatest_date]/10000)/100) + 'M'],
            }).set_index('æœ€æ–°åŸºæº–ä¾¡é¡')
            st.table(display_table)
        except Exception:
            st.warning("æœ€æ–°æ—¥ä»˜ã®ãƒ‡ãƒ¼ã‚¿è¨ˆç®—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚")

        # ã‚°ãƒ©ãƒ•æç”»
        margin = dict(t=30, b=20, l=20, r=20)
        
        col1, col2 = st.columns([1, 2])
        with col1:
            display_month = st.slider("ã‚°ãƒ©ãƒ•è¡¨ç¤ºæœŸé–“(æœˆ)", 0, 60, 12, 1)
        
        str_date2 = datetime.datetime.today() - timedelta(days=display_month*30)

        fig4 = px.line(df_buy_hyouka[str_date2 : today]['è©•ä¾¡é¡'],title='ç›´è¿‘ã®è©•ä¾¡é¡æ¨ç§»')
        fig4.update_layout(margin=margin, width=800, height=400)
        st.plotly_chart(fig4, use_container_width=True)

        df_buy_hyouka_cut = df_buy_hyouka[str_date : future_date].astype(float)
        fig3 = px.line(df_buy_hyouka_cut,title='æç›Šæ¨ç§»')
        fig3.update_layout(margin=margin, width=800, height=400)
        st.plotly_chart(fig3, use_container_width=True)

        df_hyouka = df_hyouka.astype(float)
        df_hyouka = df_hyouka[str_date : future_date]
        fig2 = px.area(df_hyouka,title='ã‚¢ã‚»ãƒƒãƒˆåˆ¥è©•ä¾¡é¡')
        fig2.update_layout(margin=margin, width=800, height=400)
        st.plotly_chart(fig2, use_container_width=True)

        # æœˆæ¬¡åˆ©ç›Š
        monthly_profit = df_buy_hyouka.groupby(pd.Grouper(freq='M'))['ç¨å¼•ãå¾Œåˆ©ç›Š'].agg('last')
        shifted_monthly_profit = monthly_profit.shift(1)
        monthly_profit_diff = monthly_profit - shifted_monthly_profit
        monthly_profit_diff_df = pd.DataFrame(monthly_profit_diff)
        monthly_profit_diff_df['ç¨å¼•ãå¾Œåˆ©ç›Š'] = (monthly_profit_diff_df['ç¨å¼•ãå¾Œåˆ©ç›Š']/10000)
        monthly_profit_diff_df = monthly_profit_diff_df.dropna(subset=['ç¨å¼•ãå¾Œåˆ©ç›Š'])
        monthly_profit_diff_df['ç¨å¼•ãå¾Œåˆ©ç›Š'] = monthly_profit_diff_df['ç¨å¼•ãå¾Œåˆ©ç›Š'].astype(int)

        monthly_profit_diff_df["12ã‚«æœˆç§»å‹•å¹³å‡"] = monthly_profit_diff_df["ç¨å¼•ãå¾Œåˆ©ç›Š"].rolling(12).mean()
        monthly_profit_diff_df["24ã‚«æœˆç§»å‹•å¹³å‡"] = monthly_profit_diff_df["ç¨å¼•ãå¾Œåˆ©ç›Š"].rolling(24).mean()
        monthly_profit_diff_df["36ã‚«æœˆç§»å‹•å¹³å‡"] = monthly_profit_diff_df["ç¨å¼•ãå¾Œåˆ©ç›Š"].rolling(36).mean()

        trace1=go.Bar(x=monthly_profit_diff_df.index, y=monthly_profit_diff_df['ç¨å¼•ãå¾Œåˆ©ç›Š'],text=monthly_profit_diff_df['ç¨å¼•ãå¾Œåˆ©ç›Š'],name='æœˆæ¬¡', yaxis='y1',marker_color='#808080')
        trace2=go.Scatter(x=monthly_profit_diff_df.index, y=monthly_profit_diff_df['12ã‚«æœˆç§»å‹•å¹³å‡'],text=monthly_profit_diff_df['12ã‚«æœˆç§»å‹•å¹³å‡'],name='12ã‚«æœˆç§»å‹•å¹³å‡', yaxis='y1',line=dict(color="#00008b"))
        trace3=go.Scatter(x=monthly_profit_diff_df.index, y=monthly_profit_diff_df['24ã‚«æœˆç§»å‹•å¹³å‡'],text=monthly_profit_diff_df['24ã‚«æœˆç§»å‹•å¹³å‡'],name='24ã‚«æœˆç§»å‹•å¹³å‡', yaxis='y1',line=dict(color="#006400"))
        
        layout = go.Layout(
            title='æœˆæ¬¡åˆ©ç›Š(ç¨å¼•ãå¾Œ)',
            xaxis = dict(title = 'æ—¥ä»˜', showgrid=False,dtick='M12'), 
            yaxis = dict(title = 'ä¸‡å††', side = 'left',dtick=50), 
        )

        fig6= go.Figure(data = [trace1,trace2,trace3],layout=layout)
        st.plotly_chart(fig6, use_container_width=True)

        # å¹´åˆ©è¨ˆç®—
        year_list = []
        this_year_end_value_list = []
        previous_year_end_value_list = []
        buy_this_year_list = []
        profit_list = []
        growth_list = []

        for year in range(2018,(datetime.date.today().year+1)):
            this_year_end_value , previous_year_end_value , buy_this_year , profit , growth = get_growth(year, df_buy_hyouka)
            if this_year_end_value != 0 or previous_year_end_value != 0:
                year_list.append(year)
                this_year_end_value_list.append(this_year_end_value)
                previous_year_end_value_list.append(previous_year_end_value)
                profit_list.append(profit)
                buy_this_year_list.append(buy_this_year)
                growth_list.append(growth)
        
        if year_list:
            growth_df = pd.DataFrame(list(zip(year_list,previous_year_end_value_list,this_year_end_value_list,buy_this_year_list,profit_list,growth_list)),columns = ['å¹´','å¹´å§‹è©•ä¾¡é¡','å¹´æœ«è©•ä¾¡é¡','è³¼å…¥é¡','åˆ©ç›Š','å¹´åˆ©(%)'])
            growth_df = growth_df.set_index('å¹´')
            st.dataframe(growth_df)
`,
          },
        },
        document.getElementById("root")
      );
    </script>
  </body>
</html>